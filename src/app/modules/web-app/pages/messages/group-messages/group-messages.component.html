<div class="card group_msg_main">
  <div class="card-body">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="tab-content">
          <div class="tab-pane active">
            <ng-container>
              <div class="feature_tab">
                <ul>
                  <li (click)="groupMessages()" [ngClass]="{ active: groupInbox === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-email-85"></i>&nbsp;{{ language.community_messages.inbox }} </a>
                  </li>
                  <li (click)="groupStarredMessages()" [ngClass]="{ active: groupStarred === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-bulb-63"></i>&nbsp;{{ language.community_messages.starred }} </a>
                  </li>
                  <li (click)="groupSentMessages()" [ngClass]="{ active: groupSent === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-send"></i>&nbsp;{{ language.community_messages.sent }} </a>
                  </li>
                  <li (click)="groupDraftsMessages()" [ngClass]="{ active: groupDrafts === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-single-copy-04"></i>&nbsp;{{ language.community_messages.drafts }} </a>
                  </li>
                  <li (click)="groupAllMailMessages()" [ngClass]="{ active: groupAllMail === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-email-85"></i>&nbsp;{{ language.community_messages.allmail }} </a>
                  </li>
                  <li (click)="groupTrashMessages()" [ngClass]="{ active: groupTrash === true }">
                    <a href="javascript:void(0)"> <i class="nc-icon nc-box"></i>&nbsp;{{ language.community_messages.trash }} </a>
                  </li>
                </ul>
              </div>
              <!-- <div class="error alert alert-danger" *ngIf="responseMessage">{{responseMessage}}</div> -->
              <ng-container *ngIf="groupInbox">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <!-- <img  onContextMenu="return false;" alt="" loading="lazy" src="../assets/img/no_record_img.png"><br> -->
                  <span>{{ language.community_messages.groupMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <div class="widget-app-content" *ngFor="let msg of filteredArray">
                            <div class="app-main-content" (click)="clickMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                              <div class="app-left-content">
                                <div class="user-img" *ngIf="msg.group">
                                  <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                  <ng-container *ngIf="msg.group.token">
                                    <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                      <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                    </ng-container>
                                    <ng-container *ngIf="msg.group.token.isLoading">
                                      <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                    </ng-container>
                                  </ng-container>
                                </div>
                                <div class="user-content">
                                  <p>{{ msg.content }}</p>
                                  <h6>{{ msg.user.firstName }} {{ msg.user.lastName }} ({{ msg.group.name }})</h6>
                                  <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                </div>
                              </div>
                              <div class="app-right-content">
                                <span class="seen-time"
                                  >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                  {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                </span>
                                <i *ngIf="msg.is_read == 0" id="envelope-{{ msg.id }}" class="fa fa-envelope-o" aria-hidden="true"></i>
                                <i *ngIf="msg.is_read == 1" id="envelope-open-{{ msg.id }}" class="fa fa-envelope-open-o" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                      <!-- <div class="chat-divider"></div> -->
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-content">
                        <div class="inner-chat">
                          <div class="chat-top-area">
                            <div class="chat-header">
                              <div class="chat-left">
                                <div class="chat-user-img-main">
                                  <div class="chat-user-img-in">
                                    <div class="chat-user-img-in" *ngIf="selectedMessage[0].group">
                                      <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="selectedMessage[0].group.image ? selectedMessage[0].group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                      <ng-container *ngIf="selectedMessage[0].group.token">
                                        <ng-container *ngIf="!selectedMessage[0].group.token.isLoading && selectedMessage[0].group.token.imageLoaded">
                                          <img [src]="selectedMessage[0].group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                        </ng-container>
                                        <ng-container *ngIf="selectedMessage[0].group.token.isLoading">
                                          <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                        </ng-container>
                                      </ng-container>
                                    </div>
                                  </div>
                                </div>
                                <div class="user-detail-info">
                                  <div class="chat-user-name" *ngIf="selectedMessage && selectedMessage[0]?.user" tooltip="{{ selectedMessage[0].user.email }}" placement="top" delay="500">
                                    "{{ selectedMessage[0].user.firstName }} {{ selectedMessage[0].user.lastName }}"
                                  </div>
                                  <div class="group_name" *ngIf="selectedMessage[0].group.id">
                                    <a routerLink="/web/community/group/{{ selectedMessage[0].group.id }}/details">({{ selectedMessage[0].group.name }})</a>
                                  </div>
                                  <div class="reply-date">{{ selectedMessage[0].created_at | date: 'dd.MM.YYYY' }} {{ selectedMessage[0].created_at | date: 'HH:mm':'GMT+2' }}</div>
                                </div>
                              </div>
                              <div class="chat-right">
                                <ul>
                                  <li>
                                    <button type="button" (click)="replyToMessages(selectedMessage[0].id, selectedMessage[0].esdb_id, selectedMessage[0].group.id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.reply }}">
                                      <i class="fa fa-reply" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="markedStarredMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" data-tooltip alt="Starred"><i class="fa fa-star-o" aria-hidden="true"></i></button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="deleteMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.trash }}">
                                      <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="chat-inner-content">
                            <h2>{{ selectedMessage[0].subject }}</h2>
                            <p>{{ selectedMessage[0].content }}</p>
                            <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                              <div *ngIf="selectedMessage[0].file_details">
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                  <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                </a>
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                  <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                  {{ selectedMessage[0].file_details }}
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="chat-form" *ngIf="isReplyMsgForm">
                        <h4 class="reply-heading" id="reply-heading"></h4>
                        <form [formGroup]="replyMsgForm" (ngSubmit)="replyMessage()">
                          <div class="multipl-participent-reply reply-users" *ngIf="singleParticipent">
                            <div class="more-toggle"><i aria-hidden="true" class="fa fa-caret-square-o-down" (click)="onOpen()"></i></div>
                            <div class="bottom-reply-to">
                              <div>
                                <Span>{{ language.create_message.all_receipient }}: </Span>
                                <span *ngFor="let touser of receipientUsers">
                                  <span class="to-username" *ngIf="touser.groupusers.length > 0" tooltip="{{ touser.groupusers[0].email }}" placement="bottom" delay="500"
                                    >"{{ touser.groupusers[0].firstname }} {{ touser.groupusers[0].lastname }}",</span
                                  >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="message_upload news_pic_upload">
                            <div class="message-upload-list" style="display: none">
                              <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                              <label class="preview_txt" style="display: none"></label>
                            </div>
                          </div>
                          <div class="chat-form-inner">
                            <div class="chat-text-area">
                              <textarea type="text" formControlName="content" placeholder="{{ language.create_message.compose_replay }}"></textarea>
                              <input type="hidden" id="replyMsgType" value="" />
                              <input type="hidden" id="replyToMsgId" value="" />
                              <label class="text-danger" *ngIf="replyMsgSubmitted && replyMsgForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                            </div>
                            <div class="chat-btn-group">
                              <div class="chat_upload_btn">
                                <input type="file" (change)="uploadFile($event)" id="add_image" accept="/" />
                                <Span class="attach_icon"><img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" /></Span>
                              </div>
                              <div class="chat_sent_btn">
                                <button type="submit"><i class="nc-icon nc-minimal-right"></i></button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupStarred">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <span>{{ language.community_messages.groupStarredMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <div class="widget-app-content" *ngFor="let msg of filteredArray">
                            <div class="app-main-content" (click)="clickMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                              <div class="app-left-content">
                                <div class="user-img" *ngIf="msg.group">
                                  <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                  <ng-container *ngIf="msg.group.token">
                                    <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                      <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                    </ng-container>
                                    <ng-container *ngIf="msg.group.token.isLoading">
                                      <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                    </ng-container>
                                  </ng-container>
                                </div>
                                <div class="user-content">
                                  <p>{{ msg.content }}</p>
                                  <h6>{{ msg.user.firstName }} {{ msg.user.lastName }}</h6>
                                  <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                </div>
                              </div>
                              <div class="app-right-content">
                                <span class="seen-time"
                                  >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                  {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                </span>
                                <i *ngIf="msg.is_read == 0" class="fa fa-envelope-o" aria-hidden="true"></i>
                                <i *ngIf="msg.is_read == 1" class="fa fa-envelope-open-o" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-content">
                        <div class="inner-chat">
                          <div class="chat-top-area">
                            <div class="chat-header">
                              <div class="chat-left">
                                <div class="chat-user-img-main">
                                  <div class="chat-user-img-in">
                                    <div class="chat-user-img-in" *ngIf="selectedMessage[0].group">
                                      <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="selectedMessage[0].group.image ? selectedMessage[0].group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                      <ng-container *ngIf="selectedMessage[0].group.token">
                                        <ng-container *ngIf="!selectedMessage[0].group.token.isLoading && selectedMessage[0].group.token.imageLoaded">
                                          <img [src]="selectedMessage[0].group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                        </ng-container>
                                        <ng-container *ngIf="selectedMessage[0].group.token.isLoading">
                                          <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                        </ng-container>
                                      </ng-container>
                                    </div>
                                  </div>
                                </div>
                                <div class="user-detail-info">
                                  <div class="chat-user-name" *ngIf="selectedMessage && selectedMessage[0]?.user" tooltip="{{ selectedMessage[0].user.email }}" placement="top" delay="500">
                                    "{{ selectedMessage[0].user.firstName }} {{ selectedMessage[0].user.lastName }}"
                                  </div>
                                  <div class="group_name" *ngIf="selectedMessage[0].group.id">
                                    <a routerLink="/web/community/group/{{ selectedMessage[0].group.id }}/details">({{ selectedMessage[0].group.name }})</a>
                                  </div>
                                  <div class="reply-date">{{ selectedMessage[0].created_at | date: 'dd.MM.YYYY' }} {{ selectedMessage[0].created_at | date: 'HH:mm':'GMT+2' }}</div>
                                </div>
                              </div>
                              <div class="chat-right">
                                <ul>
                                  <li>
                                    <button type="button" (click)="replyToMessages(selectedMessage[0].id, selectedMessage[0].esdb_id, selectedMessage[0].group.id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.reply }}">
                                      <i class="fa fa-reply" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="unmarkedStarredMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="Starred fill">
                                      <i class="fa fa-star" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="deleteMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.trash }}">
                                      <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="chat-inner-content">
                            <h2>{{ selectedMessage[0].subject }}</h2>
                            <p>{{ selectedMessage[0].content }}</p>
                            <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                              <div *ngIf="selectedMessage[0].file_details">
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                  <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                </a>
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                  <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                  {{ selectedMessage[0].file_details }}
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="chat-form" *ngIf="isReplyMsgForm">
                        <h4 class="reply-heading" id="reply-heading"></h4>
                        <form [formGroup]="replyMsgForm" (ngSubmit)="replyMessage()">
                          <div class="multipl-participent-reply reply-users" *ngIf="singleParticipent">
                            <div class="more-toggle"><i aria-hidden="true" class="fa fa-caret-square-o-down" (click)="onOpen()"></i></div>
                            <div class="bottom-reply-to">
                              <div>
                                <Span>{{ language.create_message.all_receipient }}: </Span>
                                <span *ngFor="let touser of receipientUsers">
                                  <span class="to-username" *ngIf="touser.groupusers.length > 0" tooltip="{{ touser.groupusers[0].email }}" placement="bottom" delay="500"
                                    >"{{ touser.groupusers[0].firstname }} {{ touser.groupusers[0].lastname }}",</span
                                  >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="message_upload news_pic_upload">
                            <div class="message-upload-list" style="display: none">
                              <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                              <label class="preview_txt" style="display: none"></label>
                            </div>
                          </div>
                          <div class="chat-form-inner">
                            <div class="chat-text-area">
                              <textarea type="text" formControlName="content" placeholder="{{ language.create_message.compose_replay }}"></textarea>
                              <input type="hidden" id="replyMsgType" value="" />
                              <input type="hidden" id="replyToMsgId" value="" />
                              <label class="text-danger" *ngIf="replyMsgSubmitted && replyMsgForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                            </div>
                            <div class="chat-btn-group">
                              <div class="chat_upload_btn">
                                <input type="file" (change)="uploadFile($event)" id="add_image" accept="/" />
                                <Span class="attach_icon"><img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" /></Span>
                              </div>
                              <div class="chat_sent_btn">
                                <button type="submit"><i class="nc-icon nc-minimal-right"></i></button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupSent">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <span>{{ language.community_messages.groupSentMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <div class="widget-app-content" *ngFor="let msg of filteredArray">
                            <div class="app-main-content" (click)="clickMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                              <div class="app-left-content">
                                <div class="user-img" *ngIf="msg.group">
                                  <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                  <ng-container *ngIf="msg.group.token">
                                    <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                      <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                    </ng-container>
                                    <ng-container *ngIf="msg.group.token.isLoading">
                                      <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                    </ng-container>
                                  </ng-container>
                                </div>
                                <div class="user-content">
                                  <p>{{ msg.content }}</p>
                                  <h6>{{ msg.user.firstName }} {{ msg.user.lastName }}</h6>
                                  <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                </div>
                              </div>
                              <div class="app-right-content">
                                <span class="seen-time"
                                  >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                  {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                </span>
                              </div>
                            </div>
                          </div>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-content">
                        <div class="inner-chat">
                          <div class="chat-top-area">
                            <div class="chat-header">
                              <div class="chat-left">
                                <div class="chat-user-img-main">
                                  <div class="chat-user-img-in">
                                    <div class="chat-user-img-in" *ngIf="selectedMessage[0].group">
                                      <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="selectedMessage[0].group.image ? selectedMessage[0].group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                      <ng-container *ngIf="selectedMessage[0].group.token">
                                        <ng-container *ngIf="!selectedMessage[0].group.token.isLoading && selectedMessage[0].group.token.imageLoaded">
                                          <img [src]="selectedMessage[0].group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                        </ng-container>
                                        <ng-container *ngIf="selectedMessage[0].group.token.isLoading">
                                          <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                        </ng-container>
                                      </ng-container>
                                    </div>
                                  </div>
                                </div>
                                <div class="user-detail-info">
                                  <div class="chat-user-name" *ngIf="selectedMessage && selectedMessage[0]?.user" tooltip="{{ selectedMessage[0].user.email }}" placement="top" delay="500">
                                    "{{ selectedMessage[0].user.firstName }} {{ selectedMessage[0].user.lastName }}"
                                  </div>
                                  <div class="group_name" *ngIf="selectedMessage[0].group.id">
                                    <a routerLink="/web/community/group/{{ selectedMessage[0].group.id }}/details">({{ selectedMessage[0].group.name }})</a>
                                  </div>
                                  <div class="reply-date">{{ selectedMessage[0].created_at | date: 'dd.MM.YYYY' }} {{ selectedMessage[0].created_at | date: 'HH:mm':'GMT+2' }}</div>
                                </div>
                              </div>
                              <div class="chat-right">
                                <ul>
                                  <li>
                                    <button type="button" (click)="replyToMessages(selectedMessage[0].id, selectedMessage[0].esdb_id, selectedMessage[0].group.id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.reply }}">
                                      <i class="fa fa-reply" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="markedStarredMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" data-tooltip alt="Starred"><i class="fa fa-star-o" aria-hidden="true"></i></button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="deleteMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.trash }}">
                                      <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="chat-inner-content">
                            <h2>{{ selectedMessage[0].subject }}</h2>
                            <p>{{ selectedMessage[0].content }}</p>
                            <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                              <div *ngIf="selectedMessage[0].file_details">
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                  <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                </a>
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                  <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                  {{ selectedMessage[0].file_details }}
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="chat-form" *ngIf="isReplyMsgForm">
                        <h4 class="reply-heading" id="reply-heading"></h4>
                        <form [formGroup]="replyMsgForm" (ngSubmit)="replyMessage()">
                          <div class="multipl-participent-reply reply-users" *ngIf="singleParticipent">
                            <div class="more-toggle"><i aria-hidden="true" class="fa fa-caret-square-o-down" (click)="onOpen()"></i></div>
                            <div class="bottom-reply-to">
                              <div>
                                <Span>{{ language.create_message.all_receipient }}: </Span>
                                <span *ngFor="let touser of receipientUsers">
                                  <span class="to-username" *ngIf="touser.groupusers.length > 0" tooltip="{{ touser.groupusers[0].email }}" placement="bottom" delay="500"
                                    >"{{ touser.groupusers[0].firstname }} {{ touser.groupusers[0].lastname }}",</span
                                  >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="message_upload news_pic_upload">
                            <div class="message-upload-list" style="display: none">
                              <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                              <label class="preview_txt" style="display: none"></label>
                            </div>
                          </div>
                          <div class="chat-form-inner">
                            <div class="chat-text-area">
                              <textarea type="text" formControlName="content" placeholder="{{ language.create_message.compose_replay }}"></textarea>
                              <input type="hidden" id="replyMsgType" value="" />
                              <input type="hidden" id="replyToMsgId" value="" />
                              <label class="text-danger" *ngIf="replyMsgSubmitted && replyMsgForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                            </div>
                            <div class="chat-btn-group">
                              <div class="chat_upload_btn">
                                <input type="file" (change)="uploadFile($event)" id="add_image" accept="/" />
                                <Span class="attach_icon"><img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" /></Span>
                              </div>
                              <div class="chat_sent_btn">
                                <button type="submit"><i class="nc-icon nc-minimal-right"></i></button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupDrafts">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <span>{{ language.community_messages.groupDraftMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <div class="widget-app-content" *ngFor="let msg of filteredArray">
                            <div class="app-main-content" (click)="clickDraftMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                              <div class="app-left-content">
                                <div class="user-img" *ngIf="msg.group">
                                  <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                  <ng-container *ngIf="msg.group.token">
                                    <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                      <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                    </ng-container>
                                    <ng-container *ngIf="msg.group.token.isLoading">
                                      <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                    </ng-container>
                                  </ng-container>
                                </div>
                                <div class="user-content">
                                  <p>{{ msg.content }}</p>
                                  <h6>{{ msg.user.firstName }} {{ msg.user.lastName }}</h6>
                                  <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                </div>
                              </div>
                              <div class="app-right-content">
                                <span class="seen-time"
                                  >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                  {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                </span>
                              </div>
                            </div>
                          </div>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                      <!-- <div class="chat-divider"></div> -->
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-form">
                        <div class="chat-content">
                          <div class="inner-chat">
                            <div class="chat-top-area">
                              <div class="chat-header">
                                <div class="chat-left"></div>
                                <div class="chat-right">
                                  <ul>
                                    <li>
                                      <button type="button" (click)="deleteDraftMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.delete }}">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                      </button>
                                    </li>
                                  </ul>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card draft_main">
                          <form [formGroup]="messageForm" (ngSubmit)="messageProcess()">
                            <div class="card-body">
                              <!-- profile details data start -->
                              <div class="profile_details">
                                <!-- <div class="alert alert-danger" *ngIf="responseMessage">{{responseMessage}}</div> -->
                                <div class="row">
                                  <div class="col-md-12 mb-3">
                                    <div class="news-dropdown">
                                      <div class="multi_dropdown_main">
                                        <label>{{ language.create_message.participantsto }}</label>
                                        <ng-multiselect-dropdown
                                          formControlName="kind_id"
                                          [placeholder]="language.create_message.participantsto"
                                          [settings]="groupDropdownSettings"
                                          [data]="groups"
                                          (onSelect)="onKindIdSelect($event)"
                                          (onDeSelect)="onKindIdDeSelect($event)"
                                        >
                                        </ng-multiselect-dropdown>
                                        <label class="text-danger" *ngIf="messageSubmitted && messageForm.controls['kind_id'].errors">{{ language.error_message.common_required }}</label>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div class="event_field mb-3">
                                      <label>{{ language.create_message.subject }}</label>
                                      <input type="text" formControlName="subject" placeholder="{{ language.create_message.subject_placeholder }}" />
                                      <label class="text-danger" *ngIf="messageSubmitted && messageForm.controls['subject'].errors">{{ language.error_message.common_required }}</label>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div class="event_field task_area_field mb-3">
                                      <label>{{ language.create_message.content }}</label>
                                      <textarea formControlName="content" placeholder="{{ language.create_message.content_placeholder }}"></textarea>
                                      <label class="text-danger" *ngIf="messageSubmitted && messageForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <!-- profile details data End -->
                              <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                                <div *ngIf="selectedMessage[0].file_details">
                                  <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                    <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                  </a>
                                  <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                    <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                    {{ selectedMessage[0].file_details }}
                                  </a>
                                </div>
                              </div>
                              <div class="event_upload news_pic_upload">
                                <div class="message-upload-list" style="display: none">
                                  <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                                  <label class="preview_txt" style="display: none"></label>
                                </div>
                              </div>
                              <div class="profile_sub_btn message_sub_btn">
                                <button type="submit" class="save_btn">{{ language.create_message.send }}</button>
                                <div class="message_upload">
                                  <input type="file" (change)="uploadDraftFile($event)" id="add_image" accept="/" />
                                  <span class="message_upload_overlay">
                                    <div class="upload_label">
                                      <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" />
                                      <div class="up_text">{{ language.create_message.add_file }}<br /><span>(Max 20Mb)</span></div>
                                    </div>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupAllMail">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <!-- <img  onContextMenu="return false;" alt="" loading="lazy" src="../assets/img/no_record_img.png"><br> -->
                  <span>{{ language.community_messages.groupAllMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <ng-container *ngFor="let msg of filteredArray">
                            <div class="widget-app-content">
                              <div class="app-main-content" (click)="clickMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                                <div class="app-left-content">
                                  <div class="user-img" *ngIf="msg.group">
                                    <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                    <ng-container *ngIf="msg.group.token">
                                      <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                        <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                      </ng-container>
                                      <ng-container *ngIf="msg.group.token.isLoading">
                                        <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                      </ng-container>
                                    </ng-container>
                                  </div>
                                  <div class="user-content">
                                    <p>{{ msg.content }}</p>
                                    <h6>{{ msg.user.firstName }} {{ msg.user.lastName }}</h6>
                                    <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                  </div>
                                </div>
                                <div class="app-right-content">
                                  <span class="seen-time"
                                    >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                    {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                  </span>
                                  <i *ngIf="msg.is_read == 0" class="fa fa-envelope-o" aria-hidden="true"></i>
                                  <i *ngIf="msg.is_read == 1" class="fa fa-envelope-open-o" aria-hidden="true"></i>
                                </div>
                              </div>
                            </div>
                          </ng-container>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                      <!-- <div class="chat-divider"></div> -->
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-content">
                        <div class="inner-chat">
                          <div class="chat-top-area">
                            <div class="chat-header">
                              <div class="chat-left">
                                <div class="chat-user-img-main">
                                  <div class="chat-user-img-in">
                                    <div class="chat-user-img-in" *ngIf="selectedMessage[0].group">
                                      <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="selectedMessage[0].group.image ? selectedMessage[0].group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                      <ng-container *ngIf="selectedMessage[0].group.token">
                                        <ng-container *ngIf="!selectedMessage[0].group.token.isLoading && selectedMessage[0].group.token.imageLoaded">
                                          <img [src]="selectedMessage[0].group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                        </ng-container>
                                        <ng-container *ngIf="selectedMessage[0].group.token.isLoading">
                                          <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                        </ng-container>
                                      </ng-container>
                                    </div>
                                    <!-- <div>{{selectedMessage[0].group.image}}</div> -->
                                  </div>
                                </div>
                                <div class="user-detail-info">
                                  <div class="chat-user-name" *ngIf="selectedMessage && selectedMessage[0]?.user" tooltip="{{ selectedMessage[0].user.email }}" placement="top" delay="500">
                                    "{{ selectedMessage[0].user.firstName }} {{ selectedMessage[0].user.lastName }}"
                                  </div>
                                  <div class="group_name" *ngIf="selectedMessage[0].group.id">
                                    <a routerLink="/web/community/group/{{ selectedMessage[0].group.id }}/details">({{ selectedMessage[0].group.name }})</a>
                                  </div>
                                  <div class="reply-date">{{ selectedMessage[0].created_at | date: 'dd.MM.YYYY' }} {{ selectedMessage[0].created_at | date: 'HH:mm':'GMT+2' }}</div>
                                </div>
                              </div>
                              <div class="chat-right">
                                <ul>
                                  <li>
                                    <button type="button" (click)="replyToMessages(selectedMessage[0].id, selectedMessage[0].esdb_id, selectedMessage[0].group.id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.reply }}">
                                      <i class="fa fa-reply" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="markedStarredMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" data-tooltip alt="Starred"><i class="fa fa-star-o" aria-hidden="true"></i></button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="deleteMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.trash }}">
                                      <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="chat-inner-content">
                            <h2>{{ selectedMessage[0].subject }}</h2>
                            <p>{{ selectedMessage[0].content }}</p>
                            <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                              <div *ngIf="selectedMessage[0].file_details">
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                  <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                </a>
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                  <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                  {{ selectedMessage[0].file_details }}
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="chat-form" *ngIf="isReplyMsgForm">
                        <h4 class="reply-heading" id="reply-heading"></h4>
                        <form [formGroup]="replyMsgForm" (ngSubmit)="replyMessage()">
                          <div class="multipl-participent-reply reply-users" *ngIf="singleParticipent">
                            <div class="more-toggle"><i aria-hidden="true" class="fa fa-caret-square-o-down" (click)="onOpen()"></i></div>
                            <div class="bottom-reply-to">
                              <div>
                                <Span>{{ language.create_message.all_receipient }}: </Span>
                                <span *ngFor="let touser of receipientUsers">
                                  <span class="to-username" *ngIf="touser.groupusers.length > 0" tooltip="{{ touser.groupusers[0].email }}" placement="bottom" delay="500"
                                    >"{{ touser.groupusers[0].firstname }} {{ touser.groupusers[0].lastname }}",</span
                                  >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="message_upload news_pic_upload">
                            <div class="message-upload-list" style="display: none">
                              <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                              <label class="preview_txt" style="display: none"></label>
                            </div>
                          </div>
                          <div class="chat-form-inner">
                            <div class="chat-text-area">
                              <textarea type="text" formControlName="content" placeholder="{{ language.create_message.compose_replay }}"></textarea>
                              <input type="hidden" id="replyMsgType" value="" />
                              <input type="hidden" id="replyToMsgId" value="" />
                              <label class="text-danger" *ngIf="replyMsgSubmitted && replyMsgForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                            </div>
                            <div class="chat-btn-group">
                              <div class="chat_upload_btn">
                                <input type="file" (change)="uploadFile($event)" id="add_image" accept="/" />
                                <Span class="attach_icon"><img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" /></Span>
                              </div>
                              <div class="chat_sent_btn">
                                <button type="submit"><i class="nc-icon nc-minimal-right"></i></button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupTrash">
                <div *ngIf="groupMessage && groupMessage.length == 0" class="empty-data-image">
                  <!-- <img  onContextMenu="return false;" alt="" loading="lazy" src="../assets/img/no_record_img.png"><br> -->
                  <span>{{ language.community_messages.groupTrashMessages }}</span>
                </div>
                <ng-container *ngIf="groupMessage && groupMessage.length > 0">
                  <div class="message-main-content">
                    <div class="chat_messager-widget">
                      <div class="chat-sidebar">
                        <div class="chat-search">
                          <form>
                            <div class="input-group no-border">
                              <div class="input-group-append">
                                <div class="input-group-text">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path
                                      d="M8.203 0C8.39541 0.0761099 8.60185 0.074107 8.80228 0.108156C10.7625 0.442639 12.3559 1.39602 13.5685 2.96628C14.5426 4.22811 15.1058 5.77234 15.1439 7.36664C15.184 9.12718 14.6889 10.7075 13.6667 12.0714C13.5525 12.2257 13.5665 12.2998 13.6988 12.432C15.6269 14.3527 15.4926 14.2085 17.4188 16.1313C17.6853 16.3977 17.9459 16.6601 18 17.0827C17.8557 17.6074 17.527 17.9359 16.9497 18C16.5268 17.8678 16.2603 17.5453 15.9696 17.2549C14.0916 15.3742 14.266 15.5685 12.394 13.6838C12.2817 13.5716 12.2176 13.5696 12.0953 13.6617C10.6843 14.7153 9.0909 15.22 7.33714 15.1599C5.46313 15.0958 3.8156 14.4148 2.42662 13.125C1.19398 11.9833 0.376223 10.4511 0.107648 8.79871C-0.209031 6.86191 0.171785 5.04328 1.26613 3.39891C2.37451 1.73451 3.91982 0.660955 5.87601 0.196284C6.17465 0.126182 6.47931 0.0961389 6.77795 0.0420608C6.81402 0.0340492 6.86012 0.0520752 6.87415 0C7.3171 0 7.76005 0 8.203 0ZM1.82132 7.57494C1.80128 10.7355 4.39283 13.3353 7.57165 13.3433C10.7344 13.3513 13.2979 10.7936 13.328 7.60098C13.356 4.44242 10.7865 1.85668 7.58768 1.82263C4.43893 1.79059 1.84136 4.38033 1.82132 7.57494ZM17.9439 17.2449C17.8076 17.5974 17.5691 17.8418 17.2023 17.9479L17.9439 17.2449ZM7.62777 3.33682C7.06055 3.31879 6.63765 3.76143 6.67573 4.32825C6.7098 4.80895 7.09262 5.13942 7.63578 5.15945C8.44151 5.1895 9.08289 5.536 9.55389 6.18694C9.86055 6.60955 9.98682 7.09224 10.0029 7.613C10.0189 8.1037 10.4037 8.47424 10.8787 8.48626C11.3738 8.49827 11.7626 8.15378 11.8047 7.65105C11.8308 7.35262 11.7967 7.05219 11.7346 6.75976C11.3317 4.82497 9.77236 3.47502 7.80214 3.34884C7.74602 3.34683 7.6879 3.33882 7.62777 3.33682Z"
                                      fill="#98A2C3"
                                    />
                                  </svg>
                                </div>
                              </div>
                              <input type="text" value="" class="form-control" placeholder="{{ language.community_messages.search }}..." id="myInput" (keyup)="filterArray()" />
                            </div>
                          </form>
                        </div>
                        <!-- user group info -->
                        <!-- chat sidebar widget start -->
                        <div class="widget-chat widget">
                          <!-- user group info inner -->
                          <div class="widget-app-content" *ngFor="let msg of filteredArray">
                            <div class="app-main-content" (click)="clickMessages(msg.id, msg.esdb_id)" id="message-{{ msg.id }}">
                              <div class="app-left-content">
                                <div class="user-img" *ngIf="msg.group">
                                  <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="msg.group.image ? msg.group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                  <ng-container *ngIf="msg.group.token">
                                    <ng-container *ngIf="!msg.group.token.isLoading && msg.group.token.imageLoaded">
                                      <img [src]="msg.group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                    </ng-container>
                                    <ng-container *ngIf="msg.group.token.isLoading">
                                      <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                    </ng-container>
                                  </ng-container>
                                </div>
                                <div class="user-content">
                                  <p>{{ msg.content }}</p>
                                  <h6>{{ msg.user.firstName }} {{ msg.user.lastName }}</h6>
                                  <span class="user-name" *ngIf="msg.user">{{ msg.subject }}</span>
                                </div>
                              </div>
                              <div class="app-right-content">
                                <span class="seen-time"
                                  >{{ msg.created_at | date: 'dd.MM.YYYY' }} <br />
                                  {{ msg.created_at | date: 'HH:mm':'GMT+2' }}
                                </span>
                                <i *ngIf="msg.is_read == 0" class="fa fa-envelope-o" aria-hidden="true"></i>
                                <i *ngIf="msg.is_read == 1" class="fa fa-envelope-open-o" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>
                          <!-- user group info inner -->
                        </div>
                        <!-- user group info End-->
                        <div class="chat-bottom-overlay"></div>
                      </div>
                      <!-- <div class="chat-divider"></div> -->
                    </div>
                    <!-- chat sidebar widget end -->
                    <div class="chat-screen" *ngIf="selectedMessage.length > 0">
                      <div class="chat-content">
                        <div class="inner-chat">
                          <div class="chat-top-area">
                            <div class="chat-header">
                              <div class="chat-left">
                                <div class="chat-user-img-main">
                                  <div class="chat-user-img-in">
                                    <div class="chat-user-img-in" *ngIf="selectedMessage[0].group">
                                      <!-- <img onContextMenu="return false;" alt="" loading="lazy" [src]="selectedMessage[0].group.image ? selectedMessage[0].group.image : 'assets/img/defaultProfile.jpeg'" /> -->
                                      <ng-container *ngIf="selectedMessage[0].group.token">
                                        <ng-container *ngIf="!selectedMessage[0].group.token.isLoading && selectedMessage[0].group.token.imageLoaded">
                                          <img [src]="selectedMessage[0].group.token.url" appDefaultImage alt="Image" alt="" loading="lazy" />
                                        </ng-container>
                                        <ng-container *ngIf="selectedMessage[0].group.token.isLoading">
                                          <img [src]="'../../../../assets/img/loading.gif'" alt="Image" />
                                        </ng-container>
                                      </ng-container>
                                    </div>
                                  </div>
                                </div>
                                <div class="user-detail-info">
                                  <div class="chat-user-name" *ngIf="selectedMessage && selectedMessage[0]?.user" tooltip="{{ selectedMessage[0].user.email }}" placement="top" delay="500">
                                    "{{ selectedMessage[0].user.firstName }} {{ selectedMessage[0].user.lastName }}"
                                  </div>
                                  <div class="group_name" *ngIf="selectedMessage[0].group.id">
                                    <a routerLink="/web/community/group/{{ selectedMessage[0].group.id }}/details">({{ selectedMessage[0].group.name }})</a>
                                  </div>
                                  <div class="reply-date">{{ selectedMessage[0].created_at | date: 'dd.MM.YYYY' }} {{ selectedMessage[0].created_at | date: 'HH:mm':'GMT+2' }}</div>
                                </div>
                              </div>
                              <div class="chat-right">
                                <ul>
                                  <li>
                                    <button type="button" (click)="markedStarredMessages(selectedMessage[0].id, selectedMessage[0].esdb_id)" data-tooltip alt="Starred"><i class="fa fa-star-o" aria-hidden="true"></i></button>
                                  </li>
                                  <li>
                                    <button type="button" (click)="deleteMessagesPermanently(selectedMessage[0].id, selectedMessage[0].esdb_id)" placement="bottom" delay="500" tooltip="{{ language.community_messages.delete }}">
                                      <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="chat-inner-content">
                            <h2>{{ selectedMessage[0].subject }}</h2>
                            <p>{{ selectedMessage[0].content }}</p>
                            <div class="view-attachments" *ngIf="selectedMessage[0].file_details">
                              <div *ngIf="selectedMessage[0].file_details">
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) !== -1" (click)="download(selectedMessage[0].file_details)">
                                  <img src="{{ serverUrl }}/proxyMsg/{{ selectedMessage[0].file_details }}" />
                                </a>
                                <a *ngIf="imageType.indexOf(selectedMessage[0].file_details.split('.').pop()) == -1" (click)="download(selectedMessage[0].file_details)">
                                  <img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/doc-icons/chat_doc_ic.png" />
                                  {{ selectedMessage[0].file_details }}
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="chat-form" *ngIf="isReplyMsgForm">
                        <h4 class="reply-heading" id="reply-heading"></h4>
                        <form [formGroup]="replyMsgForm" (ngSubmit)="replyMessage()">
                          <div class="chat-form-inner">
                            <div class="message_upload news_pic_upload">
                              <div class="message-upload-list" style="display: none">
                                <img onContextMenu="return false;" alt="" loading="lazy" class="preview_img" src="" />
                                <label class="preview_txt" style="display: none"></label>
                              </div>
                            </div>
                            <div class="chat-text-area">
                              <textarea type="text" formControlName="content" placeholder="{{ language.create_message.compose_replay }}"></textarea>
                              <input type="hidden" id="replyMsgType" value="" />
                              <input type="hidden" id="replyToMsgId" value="" />
                              <label class="text-danger" *ngIf="replyMsgSubmitted && replyMsgForm.controls['content'].errors">{{ language.error_message.common_required }}</label>
                            </div>
                            <div class="chat-btn-group">
                              <div class="chat_upload_btn">
                                <input type="file" (change)="uploadFile($event)" id="add_image" accept="/" />
                                <Span class="attach_icon"><img onContextMenu="return false;" alt="" loading="lazy" src="assets/img/attach.svg" /></Span>
                              </div>
                              <div class="chat_sent_btn">
                                <button type="submit"><i class="nc-icon nc-minimal-right"></i></button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="dowloading">
  <div class="overlay download-overlay">
    <div class="overlay__inner">
      <div class="overlay__content">
        <div class="loading" data-loading-text="Downloading..."></div>
      </div>
    </div>
  </div>
</div>
